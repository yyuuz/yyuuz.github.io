<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><meta name="google-site-verification" content="gO2xul9Bk4QOdd449v2eDlMVfvj7_rJbRpeTc4NDHKY"/><link rel="alternate" href="/rss.xml" title="null" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml"><link rel="alternate" type="application/json" href="https://yyuuz.github.io/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.11"><link rel="modulepreload" href="/js/chunk-AOPXSFBT.js"></link><link rel="modulepreload" href="/js/chunk-CLZFZSB4.js"></link><link rel="modulepreload" href="/js/chunk-EG7G7MBG.js"></link><link rel="modulepreload" href="/js/chunk-MQV2YQYW.js"></link><link rel="modulepreload" href="/js/chunk-PV52WCFJ.js"></link><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"></link><link rel="modulepreload" href="/js/comments-ZD6YVD66.js"></link><link rel="modulepreload" href="/js/copy-tex-ENPWXCEC.js"></link><link rel="modulepreload" href="/js/index.esm-YPW2XIKV.js"></link><link rel="modulepreload" href="/js/post-ZPKG2TP4.js"></link><link rel="modulepreload" href="/js/quicklink-MJ2QSHZM.js"></link><link rel="modulepreload" href="/js/search-EXC5BU6A.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/waline-2AUA5EA7.js"></link><link rel="stylesheet" href="/css/comments-SJZAII77.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/waline-ZFRMIHOE.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(67).webp" as="image" fetchpriority="high"><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(74).webp" as="image" fetchpriority="high"><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(33).webp" as="image" fetchpriority="high"><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(26).webp" as="image" fetchpriority="high"><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(34).webp" as="image" fetchpriority="high"><link rel="preload" href="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(16).webp" as="image" fetchpriority="high"><meta name="keywords" content="CXL,"/><link rel="canonical" href="https://yyuuz.github.io/2024/08/09/ANNS/CXL-ANNS/"><title>CXL-ANNS</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CXL-ANNS</h1><div class="meta"><span class="item" title="创建时间：2024-08-09 00:00:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-08-09T00:00:00+08:00">2024-08-09</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>5.9k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>5 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Yyuuz's Wasteland</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(67).webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(74).webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(33).webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(26).webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(34).webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/shokax/img(16).webp&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/ANNS/" itemprop="item" rel="index" title="分类于ANNS"><span itemprop="name">ANNS<meta itemprop="position" content="0"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://yyuuz.github.io/2024/08/09/ANNS/CXL-ANNS/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.webp"/><meta itemprop="name" content="GuitarYui"/><meta itemprop="description" content="In a champagne supernova in the sky, "/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name"/></span><div class="body md" itemprop="articleBody"><p>CXL-ANNS: Software-Hardware Collaborative Memory Disaggregation and Computation for Billion-Scale Approximate Nearest Neighbor Search</p>
<table>
<thead>
<tr>
<th>缩略词</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr>
<td>BI</td>
<td>Back Invalidation</td>
</tr>
<tr>
<td>DPA</td>
<td>Device Physical Address，设备物理地址</td>
</tr>
<tr>
<td>DSP</td>
<td>Downstream Switch Port，Switch 的下行端口</td>
</tr>
<tr>
<td>eRCD</td>
<td>Exclusive Restricted CXL Device，只支持 CXL 1.1 的 CXL Device</td>
</tr>
<tr>
<td>HDM</td>
<td>Host-managed Device Memory，由 Host 管理的 Device Memory</td>
</tr>
<tr>
<td>HPA</td>
<td>Host Physical Address，主机物理地址</td>
</tr>
<tr>
<td>IG</td>
<td>Interleave Granularity，交织粒度</td>
</tr>
<tr>
<td>IW</td>
<td>Interleave Way，交织路数</td>
</tr>
<tr>
<td>RP</td>
<td>Root Port，根节点</td>
</tr>
<tr>
<td>UIO</td>
<td>Unordered Input/Output，无序 IO</td>
</tr>
<tr>
<td>USP</td>
<td>Upstream Switch Port，Switch 的上行端口</td>
</tr>
</tbody>
</table>
<h1 id="introduction"><a class="anchor" href="#introduction">#</a> Introduction</h1>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123737.png" alt="image.png" /></p>
<p>不同的近似最近邻搜索（ANNS）系统在三个关键维度上的性能对比：<strong>可扩展性（Scalability）</strong>、<strong>性能（Performance）</strong> 和 <strong>准确性（Accuracy）</strong>。</p>
<blockquote>
<p><strong>可扩展性（Scalability）</strong>：指系统处理大规模数据集的能力。图中的可扩展性维度表示了系统在处理大规模 ANNS 任务时的有效性。</p>
<p><strong>性能（Performance）</strong>：指系统执行 ANNS 任务的速度和效率。图中的性能维度表示了系统在实际操作中的效率。</p>
<p><strong>准确性（Accuracy）</strong>：指 ANNS 任务的准确度，图中的准确性维度表示了系统在查询结果上的精度。</p>
</blockquote>
<p>图 1 (a): 以前的研究</p>
<ol>
<li>
<p><strong>Oracle</strong>：代表理想化的基准系统，具有最优的可扩展性、性能和准确性。</p>
</li>
<li>
<p><strong>Hierarchical（分层存储）</strong>：通过分层存储技术来处理大规模数据，但在某些维度上可能有所牺牲（例如，可能在性能或准确性上有所下降）。</p>
</li>
<li>
<p><strong>Compression（压缩）</strong>：使用数据压缩方法来提高内存利用率，但可能会影响数据的准确性和性能。</p>
</li>
</ol>
<p>图 1 (b): 基于 CXL 的方法</p>
<ol>
<li>
<p><strong>CXL</strong>：表示基于 Compute Express Link（CXL）技术的 ANNS 系统，展示了在可扩展性和性能上的显著改进，同时保持较高的准确性。</p>
</li>
<li>
<p><strong>CXL-ANNS</strong>：论文中提出的系统，利用 CXL 技术的优势，通过软硬件协同优化，在可扩展性、性能和准确性三个维度上均表现出色。</p>
</li>
</ol>
<h2 id="贡献"><a class="anchor" href="#贡献">#</a> 贡献</h2>
<ol>
<li>
<p><strong>关系感知图缓存</strong>：选择性地将图和特征向量放置在 CXL 内存网络的不同位置。具体而言，CXL-ANNS 将节点信息分配到靠近入口节点的本地附加 DRAM 中，而将其他数据集放置在 CXL 内存池中。</p>
</li>
<li>
<p><strong>隐藏 CXL 内存池的延迟</strong>：提出了一种简单的预见技术，利用 ANNS 独特的图遍历特性，在当前 kNN 候选更新阶段预取下一个邻居的数据集。</p>
</li>
<li>
<p><strong>CXL 中的协作 kNN 搜索设计</strong>：EP 控制器来计算距离，图遍历和候选更新。</p>
</li>
<li>
<p>减少依赖与调度</p>
</li>
</ol>
<h1 id="设计"><a class="anchor" href="#设计">#</a> 设计</h1>
<h2 id="节点级关系"><a class="anchor" href="#节点级关系">#</a> 节点级关系</h2>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123755.png" alt="image.png" /></p>
<p>将 enterpoint 的 2~3 跳图和节点数据放入 DRAM, 其余存入 CXL EPs</p>
<h2 id="距离计算"><a class="anchor" href="#距离计算">#</a> 距离计算</h2>
<h2 id="减少数据传输"><a class="anchor" href="#减少数据传输">#</a> 减少数据传输</h2>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123805.png" alt="image.png" /></p>
<p>CXL EP 只传输计算后的距离</p>
<h2 id="cxlanns架构"><a class="anchor" href="#cxlanns架构">#</a> CXLANNS 架构</h2>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123816.png" alt="image.png" /></p>
<p>CXLANNS 架构的高层次视图，主要由 i) RC 端软件栈和 ii) EP 端数据处理硬件栈构成。</p>
<h3 id="rc端软件栈"><a class="anchor" href="#rc端软件栈">#</a> RC 端软件栈</h3>
<p>此 RC 端软件栈由 i) 查询调度程序、ii) 池管理器和 iii) 内核驱动程序组成。在 CXL-ANNS 的顶部，查询调度程序处理来自其应用程序（如推荐系统）的所有 kNN 搜索请求。它将每个查询拆分为三个子任务（图遍历、距离计算和候选更新），并在不同的位置分配这些任务。具体而言，图遍历和候选更新子任务在 CXL CPU 端执行，而调度程序通过与底层池管理器协作将距离计算分配给底层 EP。池管理器处理 CXL 的 HPA，以考虑图形和数据向量的边缘跳数，从而可以根据节点级关系区分图形访问。最后，内核驱动程序管理底层 EP 及其地址空间；它枚举 EP 并将其 HDM 映射到系统内存的 HPA 中，供池管理器使用。由于对 HPA 的所有内存请求都在 CXL CPU 中缓存，驱动程序使用 CXL.io 而不是 CXL.mem 将 EP 端接口寄存器映射到 RC 的 PCIe 地址空间。请注意，由于存在内存映射寄存器的 PCIe 空间是在非缓存区域，底层 EP 可以立即识别主机端应用程序让 EP 知道的内容。</p>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123825.png" alt="image.png" /></p>
<h4 id="图形构建用于本地缓存"><a class="anchor" href="#图形构建用于本地缓存">#</a> 图形构建用于本地缓存</h4>
<p>当池管理器将大部分图数据和所有数据向量分配给底层的 CXL 内存池时，它会将预计最常访问的节点在本地 DRAM 中缓存，尽可能地利用系统内存容量。为此，池管理器考虑从固定的入口节点到每个节点的边缘跳数（即，计算边缘跳数）以用于其关系感知图缓存。图 13 说明了池管理器如何将给定图中的节点分配到不同的位置（本地内存与 CXL 内存池）。在构建图时，池管理器利用 [[单源最短路径（SSSP）]] 算法计算每个节点的跳数；它首先让图中的所有节点具有负跳数（例如，-1）。从入口节点开始，池管理器检查一个边缘跳中的所有节点并增加其跳数。它访问每个节点并对其迭代此过程，直到没有节点可在广度优先搜索的方式中访问。一旦每个节点都有自己的跳数，池管理器根据跳数升序对它们进行排序，并将节点从顶部（具有最小跳数）分配到本地 DRAM 中，尽可能多地进行分配。本地 DRAM 的可用大小可以通过参考系统配置变量（sysconf ()）中的总页数（SC_AVPHYS_PAGES）和每页的大小（SC_PAGESIZE）简单估算。值得一提的是，在本研究中，池管理器在用户空间中使用多个线程执行 SSSP，旨在减少构建时间。</p>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123836.png" alt="image.png" /></p>
<h4 id="池管理对于向量图"><a class="anchor" href="#池管理对于向量图">#</a> 池管理对于向量 / 图</h4>
<p>在 CXL arenas 中，CXL EP 的底层 HDM 直接暴露给用户级空间，因此需要很好地管理以适应所有十亿点数据集的内存使用行为。池管理器考虑到数据集的两个方面；数据向量（即嵌入表）应位于一个相当大且连续的内存空间中，而图结构需要处理许多长度可变的邻居列表（16B∼1KB）。池管理器采用类栈和伙伴式内存分配器，分别在每个 CXL arenas 中向上和向下增长。前者分配器具有一个范围指针，并管理嵌入表的内存，类似于栈。<strong>池管理器在多个 CXL arenas 以轮询方式分配数据向量</strong>，[[#^ac83ec | 向量分片]]。相反，伙伴式分配器采用级别指针，每个级别由一个链表组成，该链表连接不同大小的数据块（从 16B 到 1KB）。像 Linux 伙伴内存管理器一样，它根据每个邻居列表的确切需求分配 CXL 内存空间，并根据工作负载行为合并 / 拆分块。为了使每个 EP 保持平衡，池<strong>管理器以轮询方式跨不同 CXL arenas 分配每跳的邻居列表</strong>。</p>
<blockquote>
<p>意思是 figure 13 第三步吗，但后面又说是把每个向量的不同部分存在 EP 中</p>
</blockquote>
<h3 id="ep端硬件栈"><a class="anchor" href="#ep端硬件栈">#</a> EP 端硬件栈</h3>
<p>EP 端硬件堆栈包括一个用于距离计算的领域特定加速器（DSA），以及构建基于 CXL 的内存扩展器所需的所有基本硬件组件。在我们的 EP 前端，实现了物理层（PHY）控制器和 CXL 引擎，它们分别负责 PCIe/CXL 通信控制和突发到内存请求的转换。转换后的内存请求被转发到底层内存控制器，该控制器连接其后端的多个 DRAM 模块；在我们的原型中，一个 EP 有四个内存控制器，每个控制器都有一个 256GB DRAM 模块的 DIMM 通道。另一方面，DSA 位于 CXL 引擎和内存控制器之间。它可以使用内存控制器读取数据向量，同时通过 CXL 引擎的接口寄存器检查操作命令。这些接口寄存器被映射到主机的非缓存 PCIe 空间，以便主机写入的所有命令可以立即对 DSA 可见。DSA 使用多个处理元素（PE）计算多个数据向量的近似距离，每个处理元素具有简单的算术单元，如加法器 / 减法器和乘法器。</p>
<h4 id="协作查询服务加速"><a class="anchor" href="#协作查询服务加速">#</a> 协作查询服务加速</h4>
<h5 id="距离计算加速"><a class="anchor" href="#距离计算加速">#</a> 距离计算加速</h5>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240809123850.png" alt="image.png" /></p>
<p>每个 EP 有许多 processing element (PE)，在论文中的原型中为 10 个。</p>
<p><strong>向量分片</strong>。如果我们从 EP 的起始地址以连续的顺序定位嵌入表，EP 的后端 DRAM 带宽可能在我们的设计中成为瓶颈。这是因为嵌入表中的每个特征向量都是由高维信息编码的（约 256 维，约占 1KB）。（意思是每个 EP 的 DRAM 带宽连一个向量都取不出来？）为了解决这个问题，我们的池管理器按列对嵌入表进行分片，并将表的不同部分存储在不同的 EP 中。如图 15b 所示，这种向量分片根据每个 EP 的 I/O 粒度（256B）将每个向量分割成多个子向量。每个 EP 同时计算其所容纳的分割数据向量的子距离。随后，CXL CPU 累加子距离以获得最终的距离值。 ^ac83ec</p>
<p><strong>与 EP 级加速的接口</strong>。接口寄存器仅处理命令到达的事件，称为门铃，而每个 EP 的 CXL 引擎以主动方式从 CPU 侧本地 DRAM（称为命令缓冲区）中获取相应的操作类型和邻居列表。CXL 引擎还将距离计算的结果推送到本地 DRAM，以便 RC 侧软件可以直接访问结果，而无需访问底层 CXL 内存池。</p>
<h5 id="cxl内存池的预取"><a class="anchor" href="#cxl内存池的预取">#</a> CXL 内存池的预取</h5>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240808131540.png" alt="image.png" /></p>
<pre><code>Graph read: cxl侧访问邻居表传给cpu
Graph trav: cpu将要计算的邻居节点传给cxl
Dist calc:ep计算距离传给cpu
Cand update:cpu累加子距离并排序更新
</code></pre>
<p>图 17a 展示了我们协作查询服务加速的基线，这让 EP 能够在 ANNS 的图遍历和候选更新（包括子距离累积）在 CPU 侧处理时计算子距离。该调度模式会不断迭代，直到没有更多的 kNN 候选需要访问（算法 1）。这种基线方法的挑战在于，一旦 CPU 侧所有节点信息准备就绪，才可以开始图遍历。虽然我们的池管理器的本地缓存解决了这个问题，但其性能仍然有限。需要通过 CXL 内存池获取节点，这些节点并不位于最内层的边缘跳跃中。由于访问底层内存池的延迟较长，图遍历可以相对被推迟。为此，我们的查询调度器在实际遍历子任务需要之前更早地预取图信息，如图 17b 所示。</p>
<p><strong>查询调度器</strong>预测要访问的节点，并通过参考候选数组来获取其邻居信息。我们可以看到，总访问节点中有 82.3% 来自候选数组。意思就是取优先队列的第一个？</p>
<h5 id="细粒度查询调度"><a class="anchor" href="#细粒度查询调度">#</a> 细粒度查询调度</h5>
<p>RC-CPU 在 EP 距离计算时还是没事干，于是 <code>Cand update</code>  时先进行节点选择传给 CXL 再进行插入和排序。</p>
<pre><code>但是你不排序怎么选择呢？不还是预测吗
</code></pre>
<h1 id="实验分析"><a class="anchor" href="#实验分析">#</a> 实验分析</h1>
<p><img loading="lazy" data-src="https://pichost-yu.oss-cn-wuhan-lr.aliyuncs.com/img/20240808182114.png" alt="image.png" /><br />
 主要提升来自 DSA 和 cache (包括预取)</p>
<h1 id="参考"><a class="anchor" href="#参考">#</a> 参考</h1>
<p><a target="_blank" rel="noopener" href="https://www.ctyun.cn/developer/article/464924478537797">ATC2023 论文分享之 “CXL-ANNS”- 天翼云开发者社区 - 天翼云 (ctyun.cn)</a></p>
<div class="tags"><a href="/tags/CXL/" rel="tag"><i class="ic i-tag"></i>CXL</a><a href="/tags/ANNS-%E6%90%9C%E7%B4%A2/" rel="tag"><i class="ic i-tag"></i>ANNS/搜索</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2024/08/09/ANNS/CXL-ANNS/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-08-09 12:38:52" itemprop="dateModified" datetime="2024-08-09T12:38:52+08:00">2024-08-09</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.webp" alt="GuitarYui 微信支付"/><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.webp" alt="GuitarYui 支付宝"/><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>GuitarYui<i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong><a href="https://yyuuz.github.io/2024/08/09/ANNS/CXL-ANNS/" title="CXL-ANNS">https://yyuuz.github.io/2024/08/09/ANNS/CXL-ANNS/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/08/09/ANNS/%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84ANNS%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;pichost-yu.oss-cn-wuhan-lr.aliyuncs.com&#x2F;shokax&#x2F;img(95).webp" title="基于图的ANNS构建索引相关"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>ANNS</span><h3>基于图的ANNS构建索引相关</h3></a></div><div class="item right"><a href="/2024/08/10/BLOG/ShokaX%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0live2d+%E8%B5%84%E6%BA%90%E4%B8%8A%E4%BC%A0%E9%98%BF%E9%87%8C%E4%BA%91OSS/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;pichost-yu.oss-cn-wuhan-lr.aliyuncs.com&#x2F;shokax&#x2F;img(13).webp" title="ShokaX主题添加live2d+资源上传阿里云OSS"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>BLOG</span><h3>ShokaX主题添加live2d+资源上传阿里云OSS</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#introduction"><span class="toc-number">1.</span> <span class="toc-text"> Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%A1%E7%8C%AE"><span class="toc-number">1.1.</span> <span class="toc-text"> 贡献</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text"> 设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E7%BA%A7%E5%85%B3%E7%B3%BB"><span class="toc-number">2.1.</span> <span class="toc-text"> 节点级关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.</span> <span class="toc-text"> 距离计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93"><span class="toc-number">2.3.</span> <span class="toc-text"> 减少数据传输</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cxlanns%E6%9E%B6%E6%9E%84"><span class="toc-number">2.4.</span> <span class="toc-text"> CXLANNS 架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rc%E7%AB%AF%E8%BD%AF%E4%BB%B6%E6%A0%88"><span class="toc-number">2.4.1.</span> <span class="toc-text"> RC 端软件栈</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E6%9E%84%E5%BB%BA%E7%94%A8%E4%BA%8E%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98"><span class="toc-number">2.4.1.1.</span> <span class="toc-text"> 图形构建用于本地缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%A0%E7%AE%A1%E7%90%86%E5%AF%B9%E4%BA%8E%E5%90%91%E9%87%8F%E5%9B%BE"><span class="toc-number">2.4.1.2.</span> <span class="toc-text"> 池管理对于向量 &#x2F; 图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ep%E7%AB%AF%E7%A1%AC%E4%BB%B6%E6%A0%88"><span class="toc-number">2.4.2.</span> <span class="toc-text"> EP 端硬件栈</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E4%BD%9C%E6%9F%A5%E8%AF%A2%E6%9C%8D%E5%8A%A1%E5%8A%A0%E9%80%9F"><span class="toc-number">2.4.2.1.</span> <span class="toc-text"> 协作查询服务加速</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97%E5%8A%A0%E9%80%9F"><span class="toc-number">2.4.2.1.1.</span> <span class="toc-text"> 距离计算加速</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cxl%E5%86%85%E5%AD%98%E6%B1%A0%E7%9A%84%E9%A2%84%E5%8F%96"><span class="toc-number">2.4.2.1.2.</span> <span class="toc-text"> CXL 内存池的预取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%86%E7%B2%92%E5%BA%A6%E6%9F%A5%E8%AF%A2%E8%B0%83%E5%BA%A6"><span class="toc-number">2.4.2.1.3.</span> <span class="toc-text"> 细粒度查询调度</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text"> 实验分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text"> 参考</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/2024/08/01/ANNS/DF-GAS_%20a%20Distributed%20FPGA-as-a-Service%20Architecture%20towards%20Billion-Scale%20Graph-based%20Approximate%20Nearest%20Neighbor%20Search/" rel="bookmark" title="DF-GAS_ a Distributed FPGA-as-a-Service Architecture towards Billion-Scale Graph-based Approximate Nearest Neighbor Search">DF-GAS_ a Distributed FPGA-as-a-Service Architecture towards Billion-Scale Graph-based Approximate Nearest Neighbor Search</a></li><li ><a href="/2024/08/01/ANNS/Product%20Quantization/" rel="bookmark" title="Product Quantization">Product Quantization</a></li><li ><a href="/2024/08/01/ANNS/SONG/" rel="bookmark" title="SONG">SONG</a></li><li  class="active"><a href="/2024/08/09/ANNS/CXL-ANNS/" rel="bookmark" title="CXL-ANNS">CXL-ANNS</a></li><li ><a href="/2024/08/09/ANNS/%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84ANNS%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/" rel="bookmark" title="基于图的ANNS构建索引相关">基于图的ANNS构建索引相关</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="GuitarYui" src="/assets/avatar.webp"/><p class="name" itemprop="name">GuitarYui</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">6</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">2</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/yyuuz" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;yyuuz"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=1658614535" class="item music" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1658614535"><i class="ic i-cloud-music"></i></a><a target="_blank" rel="noopener" href="https://steamcommunity.com/profiles/76561199098627022/" class="item steam" title="https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561199098627022&#x2F;"><i class="ic i-steam"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/08/10/BLOG/ShokaX%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0live2d+%E8%B5%84%E6%BA%90%E4%B8%8A%E4%BC%A0%E9%98%BF%E9%87%8C%E4%BA%91OSS/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/08/09/ANNS/%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84ANNS%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/ANNS/" title="分类于ANNS">ANNS</a></div><span><a href="/2024/08/01/ANNS/DF-GAS_%20a%20Distributed%20FPGA-as-a-Service%20Architecture%20towards%20Billion-Scale%20Graph-based%20Approximate%20Nearest%20Neighbor%20Search/">DF-GAS_ a Distributed FPGA-as-a-Service Architecture towards Billion-Scale Graph-based Approximate Nearest Neighbor Search</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/BLOG/" title="分类于BLOG">BLOG</a></div><span><a href="/2024/08/10/BLOG/ShokaX%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0live2d+%E8%B5%84%E6%BA%90%E4%B8%8A%E4%BC%A0%E9%98%BF%E9%87%8C%E4%BA%91OSS/">ShokaX主题添加live2d+资源上传阿里云OSS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ANNS/" title="分类于ANNS">ANNS</a></div><span><a href="/2024/08/09/ANNS/CXL-ANNS/">CXL-ANNS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ANNS/" title="分类于ANNS">ANNS</a></div><span><a href="/2024/08/01/ANNS/SONG/">SONG</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ANNS/" title="分类于ANNS">ANNS</a></div><span><a href="/2024/08/09/ANNS/%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84ANNS%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/">基于图的ANNS构建索引相关</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ANNS/" title="分类于ANNS">ANNS</a></div><span><a href="/2024/08/01/ANNS/Product%20Quantization/">Product Quantization</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2024 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">GuitarYui @ Yyuuz's Wasteland</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">20k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">18 分钟</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a><span style="display:block">
<a href="https://icp.gov.moe/?keyword=20244924" target="_blank" data-pjax-state="external">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH5AYNFh86L9bWpwAAA7VJREFUOMvFlX1I1WcUxz/P73p/V6/ea9oVralNvWpJDSYGKgvtZc222ZixCiYR7FXW/tiGGxt7Yf/koNpA3D8OoklsbIIbWVRoG64I09uqtUzxZiPfsFJTr/fld7337I9LubhN22DswAMPnPN8znm+h+c88B+ZWixA9nTGcPq3MqZmd4HMkZjQxLrHzqiG4tA/Boe/uYP6snU1o+PV+I2dGMEVOBIgLDAxCxbzdWIt35KafFherbiq7U5ZGCxPt6ThHt6BP7ALX+BxLGYlm3JhfQ5M+0EpSNDhJzfqlBuMUJhY3UVc7GGyl3+nTlTdjAKHnfVvq+nZOkR01mYglavAEgPt/ajuQXilCHpvQdsAUp4NG5zgNeBID/w6BJpmkGSv1XrfqAeIuZchYGwkc4kuH26A7iFUaw90DUacS63wchG4x+FYH+p4LxzvRZbZoSIPakrgkzZdTfrLgXoAbV4HSScvBZovowpT4VAVLLcBAuNeePMo1HVASCLx6XZo2gZ+A1p7wLkUCYXS7uLuVUwobJNECwxOwUk3jHlgdGZerZP993fHG0SFBbxB5I4BdgtK0xzRYIWmNIWEBFquRNZCNuGDpw6BSaFKs8CkIBQmGozyiTcI8WaoKoCWHshzgMUEl8fgiRXw7Eq4NgEHXVCWBc/kgxFCzg2jvEEwab4HVKxG1JhnJTnJULMWOgdh5xoYmorouikHPmqH0gzYUwyBEDR0wvVJ1O4iGJgEkeG7uPnm6THX6L+N5KfA72OwdRXE6+CIh9JMaLoAwRB0/AFptsiZ98tgXwVS+AgMTIBudkeDNe0Mk17IdcDFUSjJhLM3QDdFEj3pjMQ5k8FjRPZ1HVB7ItJgjx/MMWejpcha1s4lt6FcQzojM3DwPHQPgd0SkSU7CQ5sgekA7D8NG3PgrVKwxULXCJi0gOSln6LvQU86Y/+PxJufk/fKUbVHH2qKyRdbUZ+2gSHfqxvv7IiWAsCRuJfx2TD9t5DN+YtTKwtQF0dg2j9HWvJnf3XdD973YhfxcfXqq67IVUse/XtoWQ5SnAlfuyDBeoCG7RcWHJvy/DEd19VWjOBmebccvAaq8Rz4gpEAq47UFINSqM9/AYveKsWrq7TmirlF57Fs+SGOKwONeP3VFKYj1YVw2wOagiQrquk8XBoRbNYm1jhfU0cqAw/9g8jrnYqfXdvwePcSCOaSagcRuDkDsXofS2wfsH19i/o4/19+TS91mOns2cys7wVQYWzWZikpaNMa183xf9ifr1JmED/Jk5sAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMDktMjFUMTU6MTU6MjIrMDg6MDAxUkujAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTA2LTEzVDIyOjMxOjU4KzA4OjAwB9q+2QAAAABJRU5ErkJggg==" style="display:initial;position:relative;top:.5vh" data-loaded="true" class="lozaded">萌ICP备20244924号</a> 
</span></div><div style="width: 100%;text-align:center;"><span id="time"></span></div><script>function createtime() {
    const n = new Date("2024/07/30 00:00:00");
    now.setTime(now.getTime() + 250), days = (now - n) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours), 1 == String(hnum).length && (hnum = "0" + hnum), minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes), 1 == String(mnum).length && (mnum = "0" + mnum), seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds), 1 == String(snum).length && (snum = "0" + snum), document.getElementById("time").innerHTML = "此站已存活" + dnum + " 天 " + hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
}

const now = new Date;
setInterval("createtime()", 250)</script></div><script src="https://unpkg.com/busuanzi@2.3.0/bsz.pure.mini.js"></script><div id="busuanzi-wrap"><span class="ic i-eye"></span><span id="busuanzi_container_site_pv">本站总访问量 <span id="busuanzi_value_site_pv"></span> 次</span> | <span class="ic i-user"></span><span id="busuanzi_container_site_uv">本站总访客量 <span id="busuanzi_value_site_uv"></span> 次</span></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/08/09/ANNS/CXL-ANNS/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.11" type="module" fetchpriority="high" defer></script></body></html><script src="/live2d-widget/autoload.js"></script>